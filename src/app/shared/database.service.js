"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var rxjs_1 = require("rxjs");
var Sqlite = require("nativescript-sqlite");
var DatabaseService = /** @class */ (function () {
    function DatabaseService() {
        this.execSQLSuccessMonitor = new rxjs_1.Subject();
    }
    DatabaseService.prototype.execSQLMonitored = function (command) {
        var _this = this;
        return this.database.all(command).then(function (result) {
            _this.execSQLSuccessMonitor.next(result);
            return Promise.resolve(result);
        });
    };
    DatabaseService.prototype.createTable = function () {
        var _this = this;
        var adamDb = new Sqlite("test-adam.db");
        var createMyTable = adamDb.then(function (db) {
            db.execSQL("CREATE TABLE IF NOT EXISTS entries (id INTEGER primary key autoincrement, glucose TEXT, dateString TEXT, isSend INTEGER DEFAULT 0);")
                .then(function (db2) {
                return db.execSQL("CREATE TABLE IF NOT EXISTS treatments (id INTEGER, basalValue TEXT, dateString TEXT, isSend INTEGER DEFAULT 0);");
            })
                .then(function (db3) {
                return db.execSQL("CREATE TABLE IF NOT EXISTS tempbasal (id INTEGER  primary key autoincrement, percentsOfBasal TEXT, minutes INTEGER, dateString TEXT, isSend INTEGER DEFAULT 0);");
            })
                .then(function (db4) {
                return db.execSQL("CREATE TABLE IF NOT EXISTS devicestatus (id INTEGER, reservoir NUMBER, voltage NUMBER, dateString TEXT, percent TEXT, status TEXT, isSend INTEGER DEFAULT 0);");
            })
                .then(function (db2) {
                return db.execSQL("CREATE TABLE IF NOT EXISTS conf (id INTEGER  primary key autoincrement, nsUrl TEXT, nsKey TEXT, nsKey2 TEXT, dateString TEXT DEFAULT SYSDATE);");
            })
                .then(function (db5) {
                return db.execSQL("CREATE TABLE IF NOT EXISTS MAC (id INTEGER  primary key autoincrement, UUID TEXT, dateString TEXT DEFAULT SYSDATE);");
            })
                .then(function (db6) {
                return db.execSQL("CREATE TABLE IF NOT EXISTS STAN (id INTEGER  primary key autoincrement, Stan Boolean, dateString TEXT DEFAULT SYSDATE);");
            })
                .then(function (db6) {
                return db.execSQL("CREATE TABLE IF NOT EXISTS DEBUG (dateString TEXT DEFAULT SYSDATE, messageType TEXT, message TEXT, category TEXT);");
            })
                .then(function (db6) {
                return db.execSQL("CREATE TABLE IF NOT EXISTS CALC (id INTEGER  primary key autoincrement, idVal INTEGER, dateString TEXT DEFAULT SYSDATE, value TEXT, hour TEXT, category TEXT);");
            })
                .then(function (id) {
                _this.database = db;
            }, function (error) {
                console.log("CREATE TABLE ERRORs", error);
            });
        }, function (error) {
            console.log("OPEN DB ERROR", error);
        });
    };
    DatabaseService.prototype.insertBG = function (bloodGlucose) {
        return this.database.execSQL("INSERT INTO entries (glucose, dateString) VALUES (?, ?)", [+bloodGlucose.value, bloodGlucose.date.toString()]);
    };
    DatabaseService.prototype.insertBGfromNs = function (value, date, isSend) {
        return this.database.execSQL("INSERT INTO entries (glucose, dateString, isSend) VALUES (?, ?, ?)", [value, date, isSend]);
    };
    DatabaseService.prototype.updateBG = function () {
        return this.database.execSQL("UPDATE entries SET isSend = 1 WHERE isSend = 0");
    };
    DatabaseService.prototype.insertTreatments = function (lastBolus) {
        return this.database.execSQL("INSERT INTO treatments (basalValue, dateString) VALUES (?, ?)", [+lastBolus.value, lastBolus.date.toString()]);
    };
    DatabaseService.prototype.updateTreatments = function () {
        return this.database.execSQL("UPDATE treatments SET isSend = 1 WHERE isSend = 0");
    };
    DatabaseService.prototype.insertDeviceStatus = function (insulinInPompLeft, batteryVoltage, data, status) {
        return this.database.execSQL("INSERT INTO devicestatus (reservoir, voltage, dateString, percent, status) VALUES (?, ?, ?, ?, ?)", [insulinInPompLeft, batteryVoltage, data.data, data.percent, status]);
    };
    DatabaseService.prototype.updateDS = function () {
        return this.database.execSQL("UPDATE devicestatus SET isSend = 1 WHERE isSend = 0");
    };
    DatabaseService.prototype.insertTempBasal = function (percentsOfBasal, minutes, dateString) {
        return this.database.execSQL("INSERT INTO tempbasal (percentsOfBasal, minutes, dateString) VALUES (?, ?, ?)", [percentsOfBasal, minutes, dateString]);
    };
    DatabaseService.prototype.updateTempBasal = function () {
        return this.database.execSQL("UPDATE tempbasal SET isSend = 1 WHERE isSend = 0");
    };
    DatabaseService.prototype.getBG = function () {
        return rxjs_1.from(this.database.all("select * from (SELECT glucose, dateString, isSend, glucose - (select e2.glucose from entries e2 where e2.rowid = e1.rowid-1 and e2.dateString < e1.dateString  ORDER BY e2.dateString LIMIT 1 ) as a from entries e1) where isSend = 0 and glucose != 0"));
    };
    DatabaseService.prototype.getTreatments = function () {
        return rxjs_1.from(this.database.all("SELECT basalValue, dateString FROM treatments WHERE isSend = 0 GROUP BY basalValue, dateString"));
    };
    DatabaseService.prototype.getDS = function () {
        return rxjs_1.from(this.execSQLMonitored("SELECT reservoir, voltage, dateString, percent, status FROM devicestatus WHERE isSend = 0"));
    };
    DatabaseService.prototype.NSconf = function () {
        return rxjs_1.from(this.database.all("SELECT nsUrl, nsKey, nsKey2 FROM conf WHERE nsUrl is not null and nsKey is not null ORDER BY id desc LIMIT 1"));
    };
    DatabaseService.prototype.insertNS = function (nsUrl, nsKey, nsKey2) {
        return this.database.execSQL("INSERT INTO conf (nsUrl, nsKey, nsKey2, dateString) VALUES (?, ?, ?, ?)", [nsUrl, nsKey, nsKey2, new Date()]);
    };
    DatabaseService.prototype.getMAC = function () {
        return this.database.all("SELECT UUID FROM MAC WHERE UUID is not null ORDER BY ID DESC LIMIT 1");
    };
    DatabaseService.prototype.insertMAC = function (uuid) {
        return this.database.execSQL("INSERT INTO MAC (uuid) VALUES (?)", [uuid]);
    };
    DatabaseService.prototype.insertStan = function (stan) {
        return this.database.execSQL("INSERT INTO STAN (stan) VALUES (?)", [stan]);
    };
    DatabaseService.prototype.getStan = function () {
        return rxjs_1.from(this.database.all("SELECT stan FROM STAN WHERE stan is not null ORDER BY ID DESC LIMIT 1; "));
    };
    DatabaseService.prototype.getLastBg = function () {
        return rxjs_1.from(this.database.all("select glucose, SUBSTR(dateString, 4, 18) from entries where glucose != 0 ORDER BY id DESC LIMIT 1"));
    };
    DatabaseService.prototype.getLastBg15 = function () {
        return rxjs_1.from(this.database.all("select glucose, datetime(substr(dateString,12,4) || '-' || case substr(dateString,5,3) when 'Jan' then '01' when 'Feb' then '02' when 'Mar' then '03' when 'Apr' then '04' when 'May' then '05' when 'Jun' then '06' when 'Jul' then '07' when 'Aug' then '08' when 'Sep' then '09' when 'Oct' then '10' when 'Nov' then '11' when 'Dec' then '12' else '01' end || '-' || substr(dateString,9,2) || ' ' || substr(dateString,17,8))  from entries where glucose != 0 and datetime(substr(dateString,12,4) || '-' || case substr(dateString,5,3) when 'Jan' then '01' when 'Feb' then '02' when 'Mar' then '03' when 'Apr' then '04' when 'May' then '05' when 'Jun' then '06' when 'Jul' then '07' when 'Aug' then '08' when 'Sep' then '09' when 'Oct' then '10' when 'Nov' then '11' when 'Dec' then '12' else '01' end || '-' || substr(dateString,9,2) || ' ' || substr(dateString,17,8)) >= datetime('now', '-1 minute', 'localtime') ORDER BY id DESC LIMIT 1"));
    };
    DatabaseService.prototype.getTempBasal = function () {
        return rxjs_1.from(this.database.all("SELECT percentsOfBasal, minutes, dateString FROM tempbasal WHERE isSend = 0 and percentsOfBasal != 0 ORDER BY ID DESC LIMIT 1; "));
    };
    DatabaseService.prototype.insertLogs = function (date, message, messageType, category) {
        return this.database.execSQL("INSERT INTO DEBUG (dateString, messageType, message, category) VALUES (?, ?, ?, ?)", [date, message, messageType, category]);
    };
    DatabaseService.prototype.insertCalc = function (date, idVal, value, hour, category) {
        return this.database.execSQL("INSERT INTO CALC (dateString, idVal, value, hour, category) VALUES (?, ?, ?, ?, ?)", [date, idVal, value, hour, category]);
    };
    DatabaseService.prototype.getCalc = function () {
        return rxjs_1.from(this.database.all("select c.idVal, c.category, c.dateString, c.value, c.hour  from CALC c where (dateString) =" +
            " (select calc2.dateString from CALC as calc2 where c.idVal != 0 order by id desc limit 1) and REPLACE(c.hour, ':', '') <= strftime('%H%M','now', 'localtime') and category = 'max' ORDER BY id DESC Limit 1"));
    };
    DatabaseService.prototype.getCalcjnaww = function () {
        return rxjs_1.from(this.database.all("select c.value from CALC c where (dateString) =" +
            " (select calc2.dateString from CALC as calc2 where c.idVal != 0 order by id desc limit 1) and REPLACE(c.hour, ':', '') <= strftime('%H%M','now', 'localtime') and category = 'jnaww' ORDER BY id DESC Limit 1"));
    };
    DatabaseService.prototype.getCalcisf = function () {
        return rxjs_1.from(this.database.all("select c.idVal, c.category, c.dateString, c.value, c.hour  from CALC c where (dateString) =" +
            " (select calc2.dateString from CALC as calc2 where c.idVal != 0 order by id desc limit 1) and REPLACE(c.hour, ':', '') <= strftime('%H%M','now', 'localtime') and category = 'isf' ORDER BY id DESC Limit 1"));
    };
    DatabaseService.prototype.getCalcBgRange = function () {
        return rxjs_1.from(this.database.all("select c.value from CALC c where (dateString) =" +
            " (select calc2.dateString from CALC as calc2 where c.idVal != 0 order by id desc limit 1) and REPLACE(c.hour, ':', '') <= strftime('%H%M','now', 'localtime') and category = 'bgrange' ORDER BY id DESC Limit 1"));
    };
    DatabaseService.prototype.getCalcStep = function () {
        return rxjs_1.from(this.database.all("select c.value from CALC c where (dateString) =" +
            " (select calc2.dateString from CALC as calc2 where c.idVal != 0 order by id desc limit 1) and REPLACE(c.hour, ':', '') <= strftime('%H%M','now', 'localtime') and category = 'step' ORDER BY id DESC Limit 1"));
    };
    DatabaseService.prototype.getLogs = function () {
        return rxjs_1.from(this.database.all("SELECT * FROM DEBUG"));
    };
    DatabaseService = __decorate([
        core_1.Injectable({
            providedIn: "root"
        })
    ], DatabaseService);
    return DatabaseService;
}());
exports.DatabaseService = DatabaseService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWJhc2Uuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRhdGFiYXNlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkM7QUFDM0MsNkJBQWlEO0FBR2pELElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBSzlDO0lBSEE7UUFLRSwwQkFBcUIsR0FBb0IsSUFBSSxjQUFPLEVBQU8sQ0FBQztJQW9SOUQsQ0FBQztJQW5SQywwQ0FBZ0IsR0FBaEIsVUFBaUIsT0FBZTtRQUFoQyxpQkFLQztRQUpDLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUEsTUFBTTtZQUMxQyxLQUFJLENBQUMscUJBQXNDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzFELE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFDRCxxQ0FBVyxHQUFYO1FBQUEsaUJBNERDO1FBM0RDLElBQU0sTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzFDLElBQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQy9CLFVBQUEsRUFBRTtZQUNBLEVBQUUsQ0FBQyxPQUFPLENBQ1IscUlBQXFJLENBQ3RJO2lCQUNFLElBQUksQ0FBQyxVQUFBLEdBQUc7Z0JBQ1AsT0FBQSxFQUFFLENBQUMsT0FBTyxDQUNSLGlIQUFpSCxDQUNsSDtZQUZELENBRUMsQ0FDRjtpQkFDQSxJQUFJLENBQUMsVUFBQSxHQUFHO2dCQUNQLE9BQUEsRUFBRSxDQUFDLE9BQU8sQ0FDUixpS0FBaUssQ0FDbEs7WUFGRCxDQUVDLENBQ0Y7aUJBQ0EsSUFBSSxDQUFDLFVBQUEsR0FBRztnQkFDUCxPQUFBLEVBQUUsQ0FBQyxPQUFPLENBQ1IsK0pBQStK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SUFDTSxpQ0FBTyxHQUFkO1FBQ0UsT0FBTyxXQUFJLENBQ1QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQ2YsNkZBQTZGO1lBQzdGLDZNQUE2TSxDQUM5TSxDQUNGLENBQUM7SUFDSixDQUFDO0lBQ00sc0NBQVksR0FBbkI7UUFDRSxPQUFPLFdBQUksQ0FDVCxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FDZixpREFBaUQ7WUFDakQsK01BQStNLENBQ2hOLENBQ0YsQ0FBQztJQUNKLENBQUM7SUFDTSxvQ0FBVSxHQUFqQjtRQUNFLE9BQU8sV0FBSSxDQUNULElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUNmLDZGQUE2RjtZQUM3Riw2TUFBNk0sQ0FDOU0sQ0FDRixDQUFDO0lBQ0osQ0FBQztJQUNNLHdDQUFjLEdBQXJCO1FBQ0UsT0FBTyxXQUFJLENBQ1QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQ2YsaURBQWlEO1lBQ2pELGlOQUFpTixDQUNsTixDQUNGLENBQUM7SUFDSixDQUFDO0lBQ00scUNBQVcsR0FBbEI7UUFDRSxPQUFPLFdBQUksQ0FDVCxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FDZixpREFBaUQ7WUFDakQsOE1BQThNLENBQy9NLENBQ0YsQ0FBQztJQUNKLENBQUM7SUFFTSxpQ0FBTyxHQUFkO1FBQ0UsT0FBTyxXQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFyUlUsZUFBZTtRQUgzQixpQkFBVSxDQUFDO1lBQ1YsVUFBVSxFQUFFLE1BQU07U0FDbkIsQ0FBQztPQUNXLGVBQWUsQ0FzUjNCO0lBQUQsc0JBQUM7Q0FBQSxBQXRSRCxJQXNSQztBQXRSWSwwQ0FBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBmcm9tLCBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSBcInJ4anNcIjtcclxuaW1wb3J0IHsgSUJhc2ljU2V0dGluZ3MgfSBmcm9tIFwifi9hcHAvbW9kZWwvbWVkLWxpbmsubW9kZWxcIjtcclxuXHJcbmNvbnN0IFNxbGl0ZSA9IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtc3FsaXRlXCIpO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46IFwicm9vdFwiXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXRhYmFzZVNlcnZpY2Uge1xyXG4gIGRhdGFiYXNlO1xyXG4gIGV4ZWNTUUxTdWNjZXNzTW9uaXRvcjogT2JzZXJ2YWJsZTxhbnk+ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gIGV4ZWNTUUxNb25pdG9yZWQoY29tbWFuZDogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLmRhdGFiYXNlLmFsbChjb21tYW5kKS50aGVuKHJlc3VsdCA9PiB7XHJcbiAgICAgICh0aGlzLmV4ZWNTUUxTdWNjZXNzTW9uaXRvciBhcyBTdWJqZWN0PGFueT4pLm5leHQocmVzdWx0KTtcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGNyZWF0ZVRhYmxlKCkge1xyXG4gICAgY29uc3QgYWRhbURiID0gbmV3IFNxbGl0ZShcInRlc3QtYWRhbS5kYlwiKTtcclxuICAgIGNvbnN0IGNyZWF0ZU15VGFibGUgPSBhZGFtRGIudGhlbihcclxuICAgICAgZGIgPT4ge1xyXG4gICAgICAgIGRiLmV4ZWNTUUwoXHJcbiAgICAgICAgICBgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgZW50cmllcyAoaWQgSU5URUdFUiBwcmltYXJ5IGtleSBhdXRvaW5jcmVtZW50LCBnbHVjb3NlIFRFWFQsIGRhdGVTdHJpbmcgVEVYVCwgaXNTZW5kIElOVEVHRVIgREVGQVVMVCAwKTtgXHJcbiAgICAgICAgKVxyXG4gICAgICAgICAgLnRoZW4oZGIyID0+XHJcbiAgICAgICAgICAgIGRiLmV4ZWNTUUwoXHJcbiAgICAgICAgICAgICAgXCJDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyB0cmVhdG1lbnRzIChpZCBJTlRFR0VSLCBiYXNhbFZhbHVlIFRFWFQsIGRhdGVTdHJpbmcgVEVYVCwgaXNTZW5kIElOVEVHRVIgREVGQVVMVCAwKTtcIlxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgICAudGhlbihkYjMgPT5cclxuICAgICAgICAgICAgZGIuZXhlY1NRTChcclxuICAgICAgICAgICAgICBcIkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHRlbXBiYXNhbCAoaWQgSU5URUdFUiAgcHJpbWFyeSBrZXkgYXV0b2luY3JlbWVudCwgcGVyY2VudHNPZkJhc2FsIFRFWFQsIG1pbnV0ZXMgSU5URUdFUiwgZGF0ZVN0cmluZyBURVhULCBpc1NlbmQgSU5URUdFUiBERUZBVUxUIDApO1wiXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgIClcclxuICAgICAgICAgIC50aGVuKGRiNCA9PlxyXG4gICAgICAgICAgICBkYi5leGVjU1FMKFxyXG4gICAgICAgICAgICAgIFwiQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgZGV2aWNlc3RhdHVzIChpZCBJTlRFR0VSLCByZXNlcnZvaXIgTlVNQkVSLCB2b2x0YWdlIE5VTUJFUiwgZGF0ZVN0cmluZyBURVhULCBwZXJjZW50IFRFWFQsIHN0YXR1cyBURVhULCBpc1NlbmQgSU5URUdFUiBERUZBVUxUIDApO1wiXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgIClcclxuICAgICAgICAgIC50aGVuKGRiMiA9PlxyXG4gICAgICAgICAgICBkYi5leGVjU1FMKFxyXG4gICAgICAgICAgICAgIFwiQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgY29uZiAoaWQgSU5URUdFUiAgcHJpbWFyeSBrZXkgYXV0b2luY3JlbWVudCwgbnNVcmwgVEVYVCwgbnNLZXkgVEVYVCwgbnNLZXkyIFRFWFQsIGRhdGVTdHJpbmcgVEVYVCBERUZBVUxUIFNZU0RBVEUpO1wiXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgIClcclxuICAgICAgICAgIC50aGVuKGRiNSA9PlxyXG4gICAgICAgICAgICBkYi5leGVjU1FMKFxyXG4gICAgICAgICAgICAgIFwiQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgTUFDIChpZCBJTlRFR0VSICBwcmltYXJ5IGtleSBhdXRvaW5jcmVtZW50LCBVVUlEIFRFWFQsIGRhdGVTdHJpbmcgVEVYVCBERUZBVUxUIFNZU0RBVEUpO1wiXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgIClcclxuICAgICAgICAgIC50aGVuKGRiNiA9PlxyXG4gICAgICAgICAgICBkYi5leGVjU1FMKFxyXG4gICAgICAgICAgICAgIFwiQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgU1RBTiAoaWQgSU5URUdFUiAgcHJpbWFyeSBrZXkgYXV0b2luY3JlbWVudCwgU3RhbiBCb29sZWFuLCBkYXRlU3RyaW5nIFRFWFQgREVGQVVMVCBTWVNEQVRFKTtcIlxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgICAudGhlbihkYjYgPT5cclxuICAgICAgICAgICAgZGIuZXhlY1NRTChcclxuICAgICAgICAgICAgICBcIkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIERFQlVHIChkYXRlU3RyaW5nIFRFWFQgREVGQVVMVCBTWVNEQVRFLCBtZXNzYWdlVHlwZSBURVhULCBtZXNzYWdlIFRFWFQsIGNhdGVnb3J5IFRFWFQpO1wiXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgIClcclxuICAgICAgICAgIC50aGVuKGRiNiA9PlxyXG4gICAgICAgICAgICBkYi5leGVjU1FMKFxyXG4gICAgICAgICAgICAgIFwiQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgQ0FMQyAoaWQgSU5URUdFUiAgcHJpbWFyeSBrZXkgYXV0b2luY3JlbWVudCwgaWRWYWwgSU5URUdFUiwgZGF0ZVN0cmluZyBURVhUIERFRkFVTFQgU1lTREFURSwgdmFsdWUgVEVYVCwgaG91ciBURVhULCBjYXRlZ29yeSBURVhUKTtcIlxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgICAudGhlbihcclxuICAgICAgICAgICAgaWQgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGF0YWJhc2UgPSBkYjtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ1JFQVRFIFRBQkxFIEVSUk9Sc1wiLCBlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGVycm9yID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIk9QRU4gREIgRVJST1JcIiwgZXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGluc2VydEJHKGJsb29kR2x1Y29zZTogeyB2YWx1ZTogbnVtYmVyOyBkYXRlOiBEYXRlOyB9KSB7XHJcbiAgICByZXR1cm4gdGhpcy5kYXRhYmFzZS5leGVjU1FMKFxyXG4gICAgICBcIklOU0VSVCBJTlRPIGVudHJpZXMgKGdsdWNvc2UsIGRhdGVTdHJpbmcpIFZBTFVFUyAoPywgPylcIixcclxuICAgICAgWytibG9vZEdsdWNvc2UudmFsdWUsIGJsb29kR2x1Y29zZS5kYXRlLnRvU3RyaW5nKCldXHJcbiAgICApO1xyXG4gIH1cclxuICBwdWJsaWMgaW5zZXJ0Qkdmcm9tTnModmFsdWUsICBkYXRlLCBpc1NlbmQpIHtcclxuICAgIHJldHVybiB0aGlzLmRhdGFiYXNlLmV4ZWNTUUwoXHJcbiAgICAgIFwiSU5TRVJUIElOVE8gZW50cmllcyAoZ2x1Y29zZSwgZGF0ZVN0cmluZywgaXNTZW5kKSBWQUxVRVMgKD8sID8sID8pXCIsXHJcbiAgICAgIFt2YWx1ZSwgZGF0ZSwgaXNTZW5kXVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyB1cGRhdGVCRygpIHtcclxuICAgIHJldHVybiB0aGlzLmRhdGFiYXNlLmV4ZWNTUUwoXHJcbiAgICAgIFwiVVBEQVRFIGVudHJpZXMgU0VUIGlzU2VuZCA9IDEgV0hFUkUgaXNTZW5kID0gMFwiXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGluc2VydFRyZWF0bWVudHMobGFzdEJvbHVzOiB7IHZhbHVlOiBudW1iZXI7IGRhdGU6IERhdGUgfSkge1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YWJhc2UuZXhlY1NRTChcclxuICAgICAgXCJJTlNFUlQgSU5UTyB0cmVhdG1lbnRzIChiYXNhbFZhbHVlLCBkYXRlU3RyaW5nKSBWQUxVRVMgKD8sID8pXCIsXHJcbiAgICAgIFsrbGFzdEJvbHVzLnZhbHVlLCBsYXN0Qm9sdXMuZGF0ZS50b1N0cmluZygpXVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyB1cGRhdGVUcmVhdG1lbnRzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YWJhc2UuZXhlY1NRTChcclxuICAgICAgXCJVUERBVEUgdHJlYXRtZW50cyBTRVQgaXNTZW5kID0gMSBXSEVSRSBpc1NlbmQgPSAwXCJcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaW5zZXJ0RGV2aWNlU3RhdHVzKFxyXG4gICAgaW5zdWxpbkluUG9tcExlZnQsXHJcbiAgICBiYXR0ZXJ5Vm9sdGFnZSxcclxuICAgIGRhdGE6IHsgZGF0YTogRGF0ZTsgcGVyY2VudDogbnVtYmVyIH0sXHJcbiAgICBzdGF0dXM6IHN0cmluZ1xyXG4gICkge1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YWJhc2UuZXhlY1NRTChcclxuICAgICAgXCJJTlNFUlQgSU5UTyBkZXZpY2VzdGF0dXMgKHJlc2Vydm9pciwgdm9sdGFnZSwgZGF0ZVN0cmluZywgcGVyY2VudCwgc3RhdHVzKSBWQUxVRVMgKD8sID8sID8sID8sID8pXCIsXHJcbiAgICAgIFtpbnN1bGluSW5Qb21wTGVmdCwgYmF0dGVyeVZvbHRhZ2UsIGRhdGEuZGF0YSwgZGF0YS5wZXJjZW50LCBzdGF0dXNdXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHVwZGF0ZURTKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YWJhc2UuZXhlY1NRTChcclxuICAgICAgXCJVUERBVEUgZGV2aWNlc3RhdHVzIFNFVCBpc1NlbmQgPSAxIFdIRVJFIGlzU2VuZCA9IDBcIlxyXG4gICAgKTtcclxuICB9XHJcbiAgcHVibGljIGluc2VydFRlbXBCYXNhbChwZXJjZW50c09mQmFzYWwsIG1pbnV0ZXMsIGRhdGVTdHJpbmcpIHtcclxuICAgIHJldHVybiB0aGlzLmRhdGFiYXNlLmV4ZWNTUUwoXHJcbiAgICAgIFwiSU5TRVJUIElOVE8gdGVtcGJhc2FsIChwZXJjZW50c09mQmFzYWwsIG1pbnV0ZXMsIGRhdGVTdHJpbmcpIFZBTFVFUyAoPywgPywgPylcIixcclxuICAgICAgW3BlcmNlbnRzT2ZCYXNhbCwgbWludXRlcywgZGF0ZVN0cmluZ11cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdXBkYXRlVGVtcEJhc2FsKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YWJhc2UuZXhlY1NRTChcclxuICAgICAgXCJVUERBVEUgdGVtcGJhc2FsIFNFVCBpc1NlbmQgPSAxIFdIRVJFIGlzU2VuZCA9IDBcIlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRCRygpOiBPYnNlcnZhYmxlPEFycmF5PEFycmF5PHN0cmluZz4+PiB7XHJcbiAgICByZXR1cm4gZnJvbShcclxuICAgICAgdGhpcy5kYXRhYmFzZS5hbGwoXHJcbiAgICAgICAgXCJzZWxlY3QgKiBmcm9tIChTRUxFQ1QgZ2x1Y29zZSwgZGF0ZVN0cmluZywgaXNTZW5kLCBnbHVjb3NlIC0gKHNlbGVjdCBlMi5nbHVjb3NlIGZyb20gZW50cmllcyBlMiB3aGVyZSBlMi5yb3dpZCA9IGUxLnJvd2lkLTEgYW5kIGUyLmRhdGVTdHJpbmcgPCBlMS5kYXRlU3RyaW5nICBPUkRFUiBCWSBlMi5kYXRlU3RyaW5nIExJTUlUIDEgKSBhcyBhIGZyb20gZW50cmllcyBlMSkgd2hlcmUgaXNTZW5kID0gMCBhbmQgZ2x1Y29zZSAhPSAwXCJcclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRUcmVhdG1lbnRzKCk6IE9ic2VydmFibGU8QXJyYXk8QXJyYXk8c3RyaW5nPj4+IHtcclxuICAgIHJldHVybiBmcm9tKFxyXG4gICAgICB0aGlzLmRhdGFiYXNlLmFsbChcclxuICAgICAgICBcIlNFTEVDVCBiYXNhbFZhbHVlLCBkYXRlU3RyaW5nIEZST00gdHJlYXRtZW50cyBXSEVSRSBpc1NlbmQgPSAwIEdST1VQIEJZIGJhc2FsVmFsdWUsIGRhdGVTdHJpbmdcIlxyXG4gICAgICApXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldERTKCk6IE9ic2VydmFibGU8QXJyYXk8QXJyYXk8c3RyaW5nPj4+IHtcclxuICAgIHJldHVybiBmcm9tKFxyXG4gICAgICB0aGlzLmV4ZWNTUUxNb25pdG9yZWQoXHJcbiAgICAgICAgXCJTRUxFQ1QgcmVzZXJ2b2lyLCB2b2x0YWdlLCBkYXRlU3RyaW5nLCBwZXJjZW50LCBzdGF0dXMgRlJPTSBkZXZpY2VzdGF0dXMgV0hFUkUgaXNTZW5kID0gMFwiXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG4gIHB1YmxpYyBOU2NvbmYoKTogT2JzZXJ2YWJsZTxBcnJheTxBcnJheTxzdHJpbmc+Pj4ge1xyXG4gICAgcmV0dXJuIGZyb20oXHJcbiAgICAgIHRoaXMuZGF0YWJhc2UuYWxsKFxyXG4gICAgICAgIFwiU0VMRUNUIG5zVXJsLCBuc0tleSwgbnNLZXkyIEZST00gY29uZiBXSEVSRSBuc1VybCBpcyBub3QgbnVsbCBhbmQgbnNLZXkgaXMgbm90IG51bGwgT1JERVIgQlkgaWQgZGVzYyBMSU1JVCAxXCJcclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcbiAgcHVibGljIGluc2VydE5TKG5zVXJsLCBuc0tleSwgbnNLZXkyKSB7XHJcbiAgICByZXR1cm4gdGhpcy5kYXRhYmFzZS5leGVjU1FMKFxyXG4gICAgICBcIklOU0VSVCBJTlRPIGNvbmYgKG5zVXJsLCBuc0tleSwgbnNLZXkyLCBkYXRlU3RyaW5nKSBWQUxVRVMgKD8sID8sID8sID8pXCIsXHJcbiAgICAgIFtuc1VybCwgbnNLZXksIG5zS2V5MiwgbmV3IERhdGUoKV1cclxuICAgICk7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRNQUMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5kYXRhYmFzZS5hbGwoXHJcbiAgICAgIFwiU0VMRUNUIFVVSUQgRlJPTSBNQUMgV0hFUkUgVVVJRCBpcyBub3QgbnVsbCBPUkRFUiBCWSBJRCBERVNDIExJTUlUIDFcIlxyXG4gICAgKTtcclxuICB9XHJcbiAgcHVibGljIGluc2VydE1BQyh1dWlkKSB7XHJcbiAgICByZXR1cm4gdGhpcy5kYXRhYmFzZS5leGVjU1FMKFwiSU5TRVJUIElOVE8gTUFDICh1dWlkKSBWQUxVRVMgKD8pXCIsIFt1dWlkXSk7XHJcbiAgfVxyXG4gIHB1YmxpYyBpbnNlcnRTdGFuKHN0YW4pIHtcclxuICAgIHJldHVybiB0aGlzLmRhdGFiYXNlLmV4ZWNTUUwoXCJJTlNFUlQgSU5UTyBTVEFOIChzdGFuKSBWQUxVRVMgKD8pXCIsIFtzdGFuXSk7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRTdGFuKCk6IE9ic2VydmFibGU8QXJyYXk8QXJyYXk8c3RyaW5nPj4+IHtcclxuICAgIHJldHVybiBmcm9tKFxyXG4gICAgICB0aGlzLmRhdGFiYXNlLmFsbChcclxuICAgICAgICBcIlNFTEVDVCBzdGFuIEZST00gU1RBTiBXSEVSRSBzdGFuIGlzIG5vdCBudWxsIE9SREVSIEJZIElEIERFU0MgTElNSVQgMTsgXCJcclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcbiAgcHVibGljIGdldExhc3RCZygpOiBPYnNlcnZhYmxlPEFycmF5PEFycmF5PHN0cmluZz4+PiB7XHJcbiAgICByZXR1cm4gZnJvbShcclxuICAgICAgdGhpcy5kYXRhYmFzZS5hbGwoXHJcbiAgICAgICAgXCJzZWxlY3QgZ2x1Y29zZSwgU1VCU1RSKGRhdGVTdHJpbmcsIDQsIDE4KSBmcm9tIGVudHJpZXMgd2hlcmUgZ2x1Y29zZSAhPSAwIE9SREVSIEJZIGlkIERFU0MgTElNSVQgMVwiXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRMYXN0QmcxNSgpOiBPYnNlcnZhYmxlPEFycmF5PEFycmF5PHN0cmluZz4+PiB7XHJcbiAgICByZXR1cm4gZnJvbShcclxuICAgICAgdGhpcy5kYXRhYmFzZS5hbGwoXHJcbiAgICAgICAgXCJzZWxlY3QgZ2x1Y29zZSwgZGF0ZXRpbWUoc3Vic3RyKGRhdGVTdHJpbmcsMTIsNCkgfHwgJy0nIHx8IGNhc2Ugc3Vic3RyKGRhdGVTdHJpbmcsNSwzKSB3aGVuICdKYW4nIHRoZW4gJzAxJyB3aGVuICdGZWInIHRoZW4gJzAyJyB3aGVuICdNYXInIHRoZW4gJzAzJyB3aGVuICdBcHInIHRoZW4gJzA0JyB3aGVuICdNYXknIHRoZW4gJzA1JyB3aGVuICdKdW4nIHRoZW4gJzA2JyB3aGVuICdKdWwnIHRoZW4gJzA3JyB3aGVuICdBdWcnIHRoZW4gJzA4JyB3aGVuICdTZXAnIHRoZW4gJzA5JyB3aGVuICdPY3QnIHRoZW4gJzEwJyB3aGVuICdOb3YnIHRoZW4gJzExJyB3aGVuICdEZWMnIHRoZW4gJzEyJyBlbHNlICcwMScgZW5kIHx8ICctJyB8fCBzdWJzdHIoZGF0ZVN0cmluZyw5LDIpIHx8ICcgJyB8fCBzdWJzdHIoZGF0ZVN0cmluZywxNyw4KSkgIGZyb20gZW50cmllcyB3aGVyZSBnbHVjb3NlICE9IDAgYW5kIGRhdGV0aW1lKHN1YnN0cihkYXRlU3RyaW5nLDEyLDQpIHx8ICctJyB8fCBjYXNlIHN1YnN0cihkYXRlU3RyaW5nLDUsMykgd2hlbiAnSmFuJyB0aGVuICcwMScgd2hlbiAnRmViJyB0aGVuICcwMicgd2hlbiAnTWFyJyB0aGVuICcwMycgd2hlbiAnQXByJyB0aGVuICcwNCcgd2hlbiAnTWF5JyB0aGVuICcwNScgd2hlbiAnSnVuJyB0aGVuICcwNicgd2hlbiAnSnVsJyB0aGVuICcwNycgd2hlbiAnQXVnJyB0aGVuICcwOCcgd2hlbiAnU2VwJyB0aGVuICcwOScgd2hlbiAnT2N0JyB0aGVuICcxMCcgd2hlbiAnTm92JyB0aGVuICcxMScgd2hlbiAnRGVjJyB0aGVuICcxMicgZWxzZSAnMDEnIGVuZCB8fCAnLScgfHwgc3Vic3RyKGRhdGVTdHJpbmcsOSwyKSB8fCAnICcgfHwgc3Vic3RyKGRhdGVTdHJpbmcsMTcsOCkpID49IGRhdGV0aW1lKCdub3cnLCAnLTEgbWludXRlJywgJ2xvY2FsdGltZScpIE9SREVSIEJZIGlkIERFU0MgTElNSVQgMVwiXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VGVtcEJhc2FsKCk6IE9ic2VydmFibGU8QXJyYXk8QXJyYXk8c3RyaW5nPj4+IHtcclxuICAgIHJldHVybiBmcm9tKFxyXG4gICAgICB0aGlzLmRhdGFiYXNlLmFsbChcclxuICAgICAgICBcIlNFTEVDVCBwZXJjZW50c09mQmFzYWwsIG1pbnV0ZXMsIGRhdGVTdHJpbmcgRlJPTSB0ZW1wYmFzYWwgV0hFUkUgaXNTZW5kID0gMCBhbmQgcGVyY2VudHNPZkJhc2FsICE9IDAgT1JERVIgQlkgSUQgREVTQyBMSU1JVCAxOyBcIlxyXG4gICAgICApXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGluc2VydExvZ3MoXHJcbiAgICBkYXRlOiBzdHJpbmcsXHJcbiAgICBtZXNzYWdlOiBzdHJpbmcsXHJcbiAgICBtZXNzYWdlVHlwZTogc3RyaW5nLFxyXG4gICAgY2F0ZWdvcnk6IHN0cmluZ1xyXG4gICkge1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YWJhc2UuZXhlY1NRTChcclxuICAgICAgXCJJTlNFUlQgSU5UTyBERUJVRyAoZGF0ZVN0cmluZywgbWVzc2FnZVR5cGUsIG1lc3NhZ2UsIGNhdGVnb3J5KSBWQUxVRVMgKD8sID8sID8sID8pXCIsXHJcbiAgICAgIFtkYXRlLCBtZXNzYWdlLCBtZXNzYWdlVHlwZSwgY2F0ZWdvcnldXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGluc2VydENhbGMoXHJcbiAgICBkYXRlOiBzdHJpbmcsXHJcbiAgICBpZFZhbDogbnVtYmVyLFxyXG4gICAgdmFsdWU6IHN0cmluZyxcclxuICAgIGhvdXI6IHN0cmluZyxcclxuICAgIGNhdGVnb3J5OiBzdHJpbmdcclxuICApIHtcclxuICAgIHJldHVybiB0aGlzLmRhdGFiYXNlLmV4ZWNTUUwoXHJcbiAgICAgIFwiSU5TRVJUIElOVE8gQ0FMQyAoZGF0ZVN0cmluZywgaWRWYWwsIHZhbHVlLCBob3VyLCBjYXRlZ29yeSkgVkFMVUVTICg/LCA/LCA/LCA/LCA/KVwiLFxyXG4gICAgICBbZGF0ZSwgaWRWYWwsIHZhbHVlLCBob3VyLCBjYXRlZ29yeV1cclxuICAgICk7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRDYWxjKCk6IE9ic2VydmFibGU8QXJyYXk8QXJyYXk8c3RyaW5nPj4+IHtcclxuICAgIHJldHVybiBmcm9tKFxyXG4gICAgICB0aGlzLmRhdGFiYXNlLmFsbChcclxuICAgICAgICBcInNlbGVjdCBjLmlkVmFsLCBjLmNhdGVnb3J5LCBjLmRhdGVTdHJpbmcsIGMudmFsdWUsIGMuaG91ciAgZnJvbSBDQUxDIGMgd2hlcmUgKGRhdGVTdHJpbmcpID1cIiArXHJcbiAgICAgICAgXCIgKHNlbGVjdCBjYWxjMi5kYXRlU3RyaW5nIGZyb20gQ0FMQyBhcyBjYWxjMiB3aGVyZSBjLmlkVmFsICE9IDAgb3JkZXIgYnkgaWQgZGVzYyBsaW1pdCAxKSBhbmQgUkVQTEFDRShjLmhvdXIsICc6JywgJycpIDw9IHN0cmZ0aW1lKCclSCVNJywnbm93JywgJ2xvY2FsdGltZScpIGFuZCBjYXRlZ29yeSA9ICdtYXgnIE9SREVSIEJZIGlkIERFU0MgTGltaXQgMVwiXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRDYWxjam5hd3coKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiBmcm9tKFxyXG4gICAgICB0aGlzLmRhdGFiYXNlLmFsbChcclxuICAgICAgICBcInNlbGVjdCBjLnZhbHVlIGZyb20gQ0FMQyBjIHdoZXJlIChkYXRlU3RyaW5nKSA9XCIgK1xyXG4gICAgICAgIFwiIChzZWxlY3QgY2FsYzIuZGF0ZVN0cmluZyBmcm9tIENBTEMgYXMgY2FsYzIgd2hlcmUgYy5pZFZhbCAhPSAwIG9yZGVyIGJ5IGlkIGRlc2MgbGltaXQgMSkgYW5kIFJFUExBQ0UoYy5ob3VyLCAnOicsICcnKSA8PSBzdHJmdGltZSgnJUglTScsJ25vdycsICdsb2NhbHRpbWUnKSBhbmQgY2F0ZWdvcnkgPSAnam5hd3cnIE9SREVSIEJZIGlkIERFU0MgTGltaXQgMVwiXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRDYWxjaXNmKCk6IE9ic2VydmFibGU8QXJyYXk8QXJyYXk8c3RyaW5nPj4+IHtcclxuICAgIHJldHVybiBmcm9tKFxyXG4gICAgICB0aGlzLmRhdGFiYXNlLmFsbChcclxuICAgICAgICBcInNlbGVjdCBjLmlkVmFsLCBjLmNhdGVnb3J5LCBjLmRhdGVTdHJpbmcsIGMudmFsdWUsIGMuaG91ciAgZnJvbSBDQUxDIGMgd2hlcmUgKGRhdGVTdHJpbmcpID1cIiArXHJcbiAgICAgICAgXCIgKHNlbGVjdCBjYWxjMi5kYXRlU3RyaW5nIGZyb20gQ0FMQyBhcyBjYWxjMiB3aGVyZSBjLmlkVmFsICE9IDAgb3JkZXIgYnkgaWQgZGVzYyBsaW1pdCAxKSBhbmQgUkVQTEFDRShjLmhvdXIsICc6JywgJycpIDw9IHN0cmZ0aW1lKCclSCVNJywnbm93JywgJ2xvY2FsdGltZScpIGFuZCBjYXRlZ29yeSA9ICdpc2YnIE9SREVSIEJZIGlkIERFU0MgTGltaXQgMVwiXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRDYWxjQmdSYW5nZSgpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xyXG4gICAgcmV0dXJuIGZyb20oXHJcbiAgICAgIHRoaXMuZGF0YWJhc2UuYWxsKFxyXG4gICAgICAgIFwic2VsZWN0IGMudmFsdWUgZnJvbSBDQUxDIGMgd2hlcmUgKGRhdGVTdHJpbmcpID1cIiArXHJcbiAgICAgICAgXCIgKHNlbGVjdCBjYWxjMi5kYXRlU3RyaW5nIGZyb20gQ0FMQyBhcyBjYWxjMiB3aGVyZSBjLmlkVmFsICE9IDAgb3JkZXIgYnkgaWQgZGVzYyBsaW1pdCAxKSBhbmQgUkVQTEFDRShjLmhvdXIsICc6JywgJycpIDw9IHN0cmZ0aW1lKCclSCVNJywnbm93JywgJ2xvY2FsdGltZScpIGFuZCBjYXRlZ29yeSA9ICdiZ3JhbmdlJyBPUkRFUiBCWSBpZCBERVNDIExpbWl0IDFcIlxyXG4gICAgICApXHJcbiAgICApO1xyXG4gIH1cclxuICBwdWJsaWMgZ2V0Q2FsY1N0ZXAoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiBmcm9tKFxyXG4gICAgICB0aGlzLmRhdGFiYXNlLmFsbChcclxuICAgICAgICBcInNlbGVjdCBjLnZhbHVlIGZyb20gQ0FMQyBjIHdoZXJlIChkYXRlU3RyaW5nKSA9XCIgK1xyXG4gICAgICAgIFwiIChzZWxlY3QgY2FsYzIuZGF0ZVN0cmluZyBmcm9tIENBTEMgYXMgY2FsYzIgd2hlcmUgYy5pZFZhbCAhPSAwIG9yZGVyIGJ5IGlkIGRlc2MgbGltaXQgMSkgYW5kIFJFUExBQ0UoYy5ob3VyLCAnOicsICcnKSA8PSBzdHJmdGltZSgnJUglTScsJ25vdycsICdsb2NhbHRpbWUnKSBhbmQgY2F0ZWdvcnkgPSAnc3RlcCcgT1JERVIgQlkgaWQgREVTQyBMaW1pdCAxXCJcclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRMb2dzKCk6IE9ic2VydmFibGU8QXJyYXk8QXJyYXk8c3RyaW5nPj4+IHtcclxuICAgIHJldHVybiBmcm9tKHRoaXMuZGF0YWJhc2UuYWxsKFwiU0VMRUNUICogRlJPTSBERUJVR1wiKSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==